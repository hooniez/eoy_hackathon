<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>
    <link rel="stylesheet" type="text/css" href="static/style.css" />
    <link href="static/bootstrap.min.css" rel="stylesheet">
    <link href="static/dashboard.css" rel="stylesheet">

</head>
<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Edu Worm</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
          <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
          <!-- <li><a href="#">Reports</a></li>
          <li><a href="#">Analytics</a></li>
          <li><a href="#">Export</a></li> -->
        </ul>
      </div>
      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div id="h1-container">
          <h1 class="page-header">Class Understanding Report</h1>
          <button type="button" class="btn btn-danger">Finish a Lesson</button>
        </div>
        

        <div id="chartContainer" class="row placeholders">
          <!-- <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div>
          <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div>
          <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div>
          <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div> -->
        </div>
        <div id="h2-container">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
            <label class="form-check-label" for="flexSwitchCheckDefault"></label>
          </div>
          <h2 class="sub-header">Individual Reports</h2>
          
          
          

        </div>
        
        <div class="row placeholders" id="individual_report_container">

          <!-- <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div>
          <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div>
          <div class="col-xs-6 col-sm-3 placeholder">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
            <h4>Label</h4>
            <span class="text-muted">Something else</span>
          </div> -->
        </div>
        <!-- <section id='students-section'>
          <div id='menu-bar'>
            <a id='toggle-students-button' onclick='togglefunc()'>Toggle</a>
          </div>
        
        
          <section id='student-graphs'>
            <div class="slidecontainer">
              <div class="studentGraph" class="row placeholders">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid1">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid2">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid3">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid4">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid5">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid6">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid7">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid8">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid9">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid10">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid11">
            </div>
            <div class="slidecontainer">
              <input type="range" min="1" max="100" value="50" class="slider" id="kid12">
            </div>
        
            
          </section>
        
        
        
        </section> -->
        
        <!-- <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>#</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1,001</td>
                <td>Lorem</td>
                <td>ipsum</td>
                <td>dolor</td>
                <td>sit</td>
              </tr>
              <tr>
                <td>1,002</td>
                <td>amet</td>
                <td>consectetur</td>
                <td>adipiscing</td>
                <td>elit</td>
              </tr>
              <tr>
                <td>1,003</td>
                <td>Integer</td>
                <td>nec</td>
                <td>odio</td>
                <td>Praesent</td>
              </tr>
              <tr>
                <td>1,003</td>
                <td>libero</td>
                <td>Sed</td>
                <td>cursus</td>
                <td>ante</td>
              </tr>
              <tr>
                <td>1,004</td>
                <td>dapibus</td>
                <td>diam</td>
                <td>Sed</td>
                <td>nisi</td>
              </tr>
              <tr>
                <td>1,005</td>
                <td>Nulla</td>
                <td>quis</td>
                <td>sem</td>
                <td>at</td>
              </tr>
              <tr>
                <td>1,006</td>
                <td>nibh</td>
                <td>elementum</td>
                <td>imperdiet</td>
                <td>Duis</td>
              </tr>
              <tr>
                <td>1,007</td>
                <td>sagittis</td>
                <td>ipsum</td>
                <td>Praesent</td>
                <td>mauris</td>
              </tr>
              <tr>
                <td>1,008</td>
                <td>Fusce</td>
                <td>nec</td>
                <td>tellus</td>
                <td>sed</td>
              </tr>
              <tr>
                <td>1,009</td>
                <td>augue</td>
                <td>semper</td>
                <td>porta</td>
                <td>Mauris</td>
              </tr>
              <tr>
                <td>1,010</td>
                <td>massa</td>
                <td>Vestibulum</td>
                <td>lacinia</td>
                <td>arcu</td>
              </tr>
              <tr>
                <td>1,011</td>
                <td>eget</td>
                <td>nulla</td>
                <td>Class</td>
                <td>aptent</td>
              </tr>
              <tr>
                <td>1,012</td>
                <td>taciti</td>
                <td>sociosqu</td>
                <td>ad</td>
                <td>litora</td>
              </tr>
              <tr>
                <td>1,013</td>
                <td>torquent</td>
                <td>per</td>
                <td>conubia</td>
                <td>nostra</td>
              </tr>
              <tr>
                <td>1,014</td>
                <td>per</td>
                <td>inceptos</td>
                <td>himenaeos</td>
                <td>Curabitur</td>
              </tr>
              <tr>
                <td>1,015</td>
                <td>sodales</td>
                <td>ligula</td>
                <td>in</td>
                <td>libero</td>
              </tr>
            </tbody>
          </table>
        </div> -->
      </div>
    </div>
  </div>


<!-- <div id="chartContainer" style="height: 370px; width:100%;"></div> -->




<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
<!-- <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script> -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://use.fontawesome.com/d39c20706a.js"></script>
<script>

  const min_warning_score = 30

  const random_sentences = [
    "...thanks for clarification...",
      "...when you design your system you need to know exactly who you are designing for...",
      "...Does everyone understand this point...",
      "...So does everyone understand what AES-128 is...",
      "...How does this kind of thing effect our choice of technique...",
      "...This is a really important area for understanding...",
      "...Does everyone understand what the four different techniques are...",
      "...Any further questions about what we will cover on the exam...",
      "...all these things mentioned in the spec should be considered...",
      "...another friend of yours asked the same question...",
      "...encryption is an important consideration in all software...haha",
      "...we will do our best to put you on the right paths...",
      "...SHA-256 is stronger than SHA-128...",
      "...we would be more than happy to go there to answer your questions...",
      "...Thanks Jim, Can everyone get that version working...",
      "...So no idea what would be the possible system?...",
      "...What else?...",
      "...Does everyone understand what is happening in the project...",
      "...So that is what a HMAC is, and why its so important to security...",
      "...What is it that the IV does, anyone know...."       
  ]

  const random_questions = [
    "Why is ___?",
    "What is exactly ___?",
    "Where could I ___?",
    "When should I ___?",
    "How come is ___?"
  ]

  let chart_intervals = []
  let chart_container_ids = []
  let chart_titles = []

  String.prototype.repeat = function( num ) {
    return new Array( num + 1 ).join(this);
  }

  function togglefunc() {
    console.log('toggled');
    let x = document.getElementById("student-graphs");
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }
  }

  function individual_graph_generator(num_students) {
    let str_python_graphs = '<div class="col-xs-6 col-sm-3 placeholder python_graphs"><div>hi</div></div>';
    let num_python_graphs = num_students;
    $str_python_graphs = $(str_python_graphs.repeat(num_python_graphs));

    let id_python_graph_container_name = "individual_chart_python_graph_container";
    let id_python_graph_name = "individual_chart_python_graph";
    for (let i = 0; i < num_python_graphs; i++) {
      $("#individual_report_container").append($str_python_graphs);
      
      $(".python_graphs:eq(" + i + ")").attr('id', id_python_graph_container_name + "_" + i); // python_graph_contianer selected
      $("#" + id_python_graph_container_name + "_" + i + " div").attr('id', id_python_graph_name + "_" + i); // python_graph selected
      $("#" + id_python_graph_name + "_" + i).addClass("graphs");
      chart_intervals.push(graph_generator("#" + id_python_graph_name + "_" + i, "Student" + i));
      chart_titles.push("Student" + i);
      chart_container_ids.push("#" + id_python_graph_name + "_" + i);


      

    }


  }

  function individual_question_panel_generator(num_students) {
    let str_question_panels = '<div class="question_panels"></div>';
    let num_question_panels = num_students;
    $str_question_panels = $(str_question_panels.repeat(num_question_panels));

    let id_question_panel_container_name = "individual_question_panel_container";
    let id_question_panel_name = "individual_question_panel";
    for (let i = 0; i < num_question_panels; i++) {
      rand_num = Math.round(Math.random());
      if (rand_num == 0) {
        $("#individual_chart_python_graph_" + i).prepend(str_question_panels);
        $("#individual_chart_python_graph_" + i).find(".question_panels").attr('id', "student" + i);
        $("#student" + i).html('<div class="jumbotron"><div class="container"><div class="card-heading-container"><span><b>Student' + i + '</b></span><i class="fa fa-times" style="cursor: pointer;" aria-hidden="true"></i></div><h3>Question</h3><p>' + random_questions[Math.floor(Math.random()*random_questions.length)] +'</p></div>');
      } else {

      }


      

      
      // $(".python_graphs:eq(" + i + ")").attr('id', id_python_graph_container_name + "_" + i); // python_graph_contianer selected
      // $("#" + id_python_graph_container_name + "_" + i + " div").attr('id', id_python_graph_name + "_" + i); // python_graph selected
      // chart_intervals.push(graph_generator("#" + id_python_graph_name + "_" + i, "Student" + i));
      // chart_titles.push("Student" + i);
      // chart_container_ids.push("#" + id_python_graph_name + "_" + i);


      

    }


  }

  // function summary_report_generator() {
  //   let html = '<div class="summary_report_container"></div>';
  //   $(".main").prepend('<div class="overlay"><img id="ces_img" src="ces_questions.png"></div>');
  //   $(".main").toggleClass('opacity8');

  // }

  let charts = []

  function graph_generator(id,title) {
    const XAXISRANGE = 10;
      // In case the backend doesn't work
      let count = 0;
      let data = [
        {'x': count, 'y':100}
      ]
      // let count = 1
      // let data = []
      function getNewSeries() {
        ran_num = parseInt(Math.random() * (5 - 1) + 1);
        if (ran_num == 5) {
          y_ran_num = 100 - parseInt(Math.random() * 70)
          if (y_ran_num == 0) {
            y_ran_num = 50
          }
        } else if (ran_num == 4) {
          y_ran_num = parseInt(Math.random() * 70)
        } else {
          y_ran_num = 100 - parseInt(Math.random() * (20 + 5) - 5)
        if (y_ran_num > 100) {
          y_ran_num = 100;
        } 

        }
        
              data.push({
                  "x": count,
                  // "y": getMeanScore(),
                  // "y": parseInt(Math.random() * (100 - 0) + 0)
                  "y": y_ran_num

              });
              count++
          return data;
      }

      async function getClientValAverage() {
        cliVals = []
        recValues = await getRecentValues();
        recValues = recValues.values;
        for (let i = 0; i < recValues.length; i++) {
          cliVals.push(parseInt(recValues[i].value))
        }
        console.log(recValues);
        ave = getMeanScore(cliVals);
        console.log(cliVals);
        console.log(ave);
        data.push({
          "x": count,
          "y": ave
        });
        count++
        return data;
      }
      
      
  
      function getMeanScore(scores) {
        document.querySelectorAll(".slider").forEach(x => scores.push(parseInt(x.value)));
        console.log(scores);
        console.log(scores.reduce((a,b) => a + b, 0) / scores.length);
        return Math.round(scores.reduce((a,b) => a + b, 0) / scores.length);
      }

  
      let options = {
            series: [{
              name: 'data',
            
              data: data.slice()
          }],
            chart: {
            id: 'realtime',
            height: 350,
            type: 'line',
            animations: {
              enabled: true,
              easing: 'linear',
              dynamicAnimation: {
                speed: 1000
              }
            },
            toolbar: {
              show: false
            },
            zoom: {
              enabled: false
            }
          },
          dataLabels: {
            enabled: false
          },
          stroke: {
            curve: 'smooth'
          },
          title: {
            text: title,
            align: 'left'
          },
          markers: {
            size: 0
          },
          xaxis: {
            type: 'numeric',
            range: XAXISRANGE,
          },
          yaxis: {
            max: 100,
            min: 0
          },
          legend: {
            show: false
          },
      };


  
      let chart = new ApexCharts(document.querySelector(id, title), options);
      charts.push(chart);
      chart.render();

      // let studentChart = new ApexCharts(document.querySelector(".studentGraph"), options);
      // studentChart.render();
        
        
      let chart_interval = window.setInterval(() => {
        getClientValAverage();
        // getNewSeries()
        chart.updateSeries([{
              data: data
          }]);
          if (data[data.length - 1].y < min_warning_score) {
                if (!$(id).is("warning")) {
                  $(id).toggleClass("warning")
                }
                  
              } else {
                if ($(id).is("warning")) {
                  $(id).toggleClass("warning")
                }
                 
              }
        // getStudentSeries()

          // studentChart.updateSeries([{
          //     data: studentData
          // }]);
      }, 1000);

      return chart_interval

  }

async function getRecentValues() {
  const url = "http://127.0.0.1:5000/recentval"
  let result = await get(url);
  // console.log(result)
  return result
}

function get(url, params = null) {
  return new Promise((resolve, reject) => {
    const target = new URL(url);

    if (params != null) {
      target.search = formatParams(params);
    }
  
    const xhr = new XMLHttpRequest();
    xhr.responseType = "json";

    xhr.onload = () => {
      resolve(xhr.response);
    };

    xhr.open("GET", target.toString(), true);
    xhr.send();
  });
}

window.onload = function () {
  let num_students = 8
  chart_intervals.push(graph_generator("#chartContainer", "Group"));
  chart_container_ids.push("#chartContainer");
  chart_titles.push("Group");
  individual_graph_generator(num_students);

  $('#individual_report_container').on("click", ".fa.fa-times", function() {
    $(this).parent().parent().parent().parent().css('transition', 'opacity 1s');
    $(this).parent().parent().parent().parent().css('opacity', '0.0');
    

  });

  // $('.main').on("click", "#ces_img", function() {
  //   $(this).hide();
  //   $(this).toggleClass("overlay");
    

  // });
  
  $('.btn-danger').click(function() {
    // summary_report_generator();


    for (let i = 0; i < chart_container_ids.length; i++) {
      clearInterval(chart_intervals[i]);
      data_y = charts[i].data.twoDSeries;
      data_x = charts[i].data.twoDSeriesX;
      last_x_value = charts[i].data.twoDSeriesX.at(-1);
      $(chart_container_ids[i]).empty();
  
      data_y_copy = [...data_y];
      min_y_1 = Math.min(...data_y_copy);
      min_y_1_index = data_y_copy.indexOf(min_y_1);
      data_y_copy.splice(min_y_1_index, 1);
      min_y_2 = Math.min(...data_y_copy);
      min_y_2_index = data_y_copy.indexOf(min_y_2);
      data_y_copy.splice(min_y_2_index, 1);
      min_y_3 = Math.min(...data_y_copy);
      min_y_3_index = data_y_copy.indexOf(min_y_3);
      data_y_copy.splice(min_y_3_index, 1);
      min_x_1 = data_x[min_y_1_index];
      min_x_2 = data_x[min_y_2_index];
      min_x_3 = data_x[min_y_3_index];
      
      let options = {
              series: [{
                name: 'data',
              
                data: data_y.slice()
            }],
              chart: {
                // background: "#000",
              id: 'line',
              height: 350,
              type: 'line',
              animations: {
                enabled: true,
                easing: 'linear',
                dynamicAnimation: {
                  speed: 1000
                }
              },
              toolbar: {
                show: false
              },
              zoom: {
                enabled: false
              }
            },
            dataLabels: {
              enabled: false
            },
            // colors: ["#FFFF00"],
            stroke: {
              curve: 'smooth'
            },
            title: {
              text: chart_titles[i],
              align: 'left'
            },
            markers: {
              size: 0
            },
            xaxis: {
              type: 'numeric',
              range: last_x_value,
            },
            yaxis: {
              max: 100,
              min: 0
            },
            legend: {
              show: false
            },
            points:
            [
              {
                x:min_x_1.toString(),
                y:min_y_1,
                marker: {
                  size: 8,
                },
                label: {
                  borderColor: "#FF4560",
                  text: "Worst 1"
                }
              },
              {
                x:min_x_2.toString(),
                y:min_y_2,
                marker: {
                  size: 8,
                },
                label: {
                  borderColor: "#FF4560",
                  text: "Worst 2"
                }
              },
              {
                x:min_x_3.toString(),
                y:min_y_3,
                marker: {
                  size: 8,
                },
                label: {
                  borderColor: "#FF4560",
                  text: "Worst 3"
                }
              },
            ],
            tooltip: {
              custom: function({series, seriesIndex, dataPointIndex, w}) {
                return '<div class="arrow_box">' + '<span>' + random_sentences[Math.floor(Math.random()*random_sentences.length)] + "</span>" + "</div>"
              }
            },
            
        };
  
        let chart = new ApexCharts(document.querySelector(chart_container_ids[i]), options);
        chart.render();
        console.log(chart);
  
      }

      individual_question_panel_generator(num_students);
    


  });

  $("#flexSwitchCheckDefault").change(function() {
    if (this.checked) {
      $("#individual_report_container").toggleClass("opacity1");
    } else {
      $("#individual_report_container").toggleClass("opacity1");
    }


  });

   


}






  </script>

</body>
</html>